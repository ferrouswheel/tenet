<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tenet</title>
    <style>
        {{STYLES}}
    </style>
</head>
<body>
    <div class="header">
        <div style="display:flex;align-items:center;gap:0.75rem;">
            <h1>Tenet</h1>
            <span class="status-dot" id="status-dot"></span>
        </div>
        <div class="peer-id" id="peer-id" title=""></div>
    </div>

    <!-- Relay status banner -->
    <div class="relay-banner" id="relay-banner" style="display:none;">
        <span class="relay-banner-icon">&#9888;</span>
        <span id="relay-banner-text">Relay unavailable</span>
    </div>

    <div class="container">
        <!-- Sidebar -->
        <div class="sidebar">
            <!-- My profile (Phase 10) -->
            <div class="profile-card" id="my-profile-card" onclick="showMyProfile()">
                <div class="profile-avatar" id="my-profile-avatar"></div>
                <div class="profile-info">
                    <div class="profile-name" id="my-profile-name">Me</div>
                    <div class="profile-bio" id="my-profile-bio"></div>
                </div>
            </div>
            <div class="peer-id-display" id="peer-id-display">
                <span class="peer-id-label">Your Peer ID</span>
                <div class="peer-id-row">
                    <code class="peer-id-full" id="peer-id-full"></code>
                    <button class="copy-btn" onclick="event.stopPropagation();copyPeerId()" title="Copy Peer ID">Copy</button>
                </div>
            </div>

            <!-- Friends list -->
            <div class="friends-panel">
                <h2>Friends</h2>
                <div id="friends-list"></div>
                <button class="add-friend-btn" onclick="toggleAddFriendForm()">+ Add Friend</button>
            </div>

            <!-- Add friend form (simplified - just peer ID + message) -->
            <div id="add-friend-form" class="add-friend-form">
                <h3>Send Friend Request</h3>
                <input type="text" id="friend-peer-id" placeholder="Peer ID" />
                <input type="text" id="friend-message" placeholder="Message (optional)" />
                <div class="form-actions">
                    <button class="btn-secondary" onclick="toggleAddFriendForm()">Cancel</button>
                    <button class="btn-primary" onclick="sendFriendRequest()">Send Request</button>
                </div>
            </div>

            <!-- Friend Requests panel -->
            <div class="friend-requests-panel" id="friend-requests-panel">
                <div class="friend-requests-header" onclick="toggleFriendRequests()">
                    <h2>Friend Requests <span class="fr-badge" id="fr-pending-badge"></span></h2>
                </div>
                <div id="friend-requests-content" class="friend-requests-content">
                    <div class="fr-tabs">
                        <button class="fr-tab active" data-fr-tab="pending" onclick="switchFrTab('pending')">Pending</button>
                        <button class="fr-tab" data-fr-tab="history" onclick="switchFrTab('history')">History</button>
                    </div>
                    <div class="fr-toggle-hidden">
                        <label><input type="checkbox" id="fr-show-hidden" onchange="loadFriendRequests()"> Show blocked &amp; ignored</label>
                    </div>
                    <div id="friend-requests-list"></div>
                </div>
            </div>
        </div>

        <!-- Main content -->
        <div class="main-content">
            <!-- Filter tabs -->
            <div class="filters">
                <button class="active" data-kind="">All</button>
                <button data-kind="public">Public</button>
                <button data-kind="direct">Direct</button>
                <button data-kind="friend_group">Groups</button>
                <button data-view="conversations">Conversations</button>
            </div>

            <!-- Compose box -->
            <div class="compose" id="compose-box">
                <textarea id="compose-body" placeholder="Write a message..."></textarea>
                <div class="compose-attachments">
                    <div class="attachment-picker">
                        <label for="attachment-input">Attach file</label>
                        <input type="file" id="attachment-input" multiple onchange="handleFileSelect(this.files)" />
                    </div>
                    <div class="attachment-previews" id="attachment-previews"></div>
                </div>
                <div class="compose-actions">
                    <select id="compose-kind">
                        <option value="public">Public</option>
                    </select>
                    <button id="compose-send" onclick="sendMessage()">Send</button>
                </div>
            </div>

            <!-- Timeline -->
            <div id="timeline"></div>

            <!-- Conversations list -->
            <div id="conversations-list" style="display:none;"></div>

            <!-- Conversation detail -->
            <div id="conversation-detail" class="conversation-detail">
                <div class="conversation-back">
                    <button onclick="backToConversations()">&#8592; Back</button>
                    <span class="peer-name" id="conversation-peer-name"></span>
                </div>
                <div id="conversation-messages"></div>
                <div id="conversation-load-more" class="load-more" style="display:none;">
                    <button onclick="loadMoreConversationMessages()">Load older messages</button>
                </div>
            </div>

            <!-- Post detail -->
            <div id="post-detail" class="post-detail">
                <div class="post-detail-back">
                    <button onclick="backToPublicFeed()">&#8592; Back to Feed</button>
                </div>
                <div id="post-detail-content"></div>
                <!-- Reply compose (Phase 9) -->
                <div class="reply-compose" id="reply-compose">
                    <textarea id="reply-body" placeholder="Write a reply..."></textarea>
                    <div class="reply-compose-actions">
                        <button onclick="sendReply()">Reply</button>
                    </div>
                </div>
                <!-- Replies list (Phase 9) -->
                <div id="post-replies"></div>
                <div id="replies-load-more" class="load-more" style="display:none;">
                    <button onclick="loadMoreReplies()">Load more replies</button>
                </div>
            </div>

            <!-- Profile view (Phase 10) -->
            <div id="profile-view" class="profile-view">
                <div class="profile-view-back">
                    <button onclick="backFromProfile()">&#8592; Back</button>
                </div>
                <div id="profile-view-content"></div>
            </div>

            <!-- Profile edit (Phase 10) -->
            <div id="profile-edit" class="profile-edit">
                <div class="profile-edit-back">
                    <button onclick="backFromProfile()">&#8592; Back</button>
                    <span>Edit Profile</span>
                </div>
                <div class="profile-edit-form">
                    <label>Your Peer ID</label>
                    <div class="profile-peer-id-row">
                        <code class="profile-peer-id" id="profile-edit-peer-id"></code>
                        <button type="button" class="copy-btn" onclick="copyPeerId()">Copy</button>
                    </div>
                    <label>Display Name</label>
                    <input type="text" id="profile-display-name" placeholder="Your name" />
                    <label>Bio</label>
                    <textarea id="profile-bio" placeholder="Tell us about yourself..." rows="3"></textarea>
                    <label>Avatar (upload an image first)</label>
                    <input type="text" id="profile-avatar-hash" placeholder="Attachment content hash" />
                    <div class="form-actions">
                        <button class="btn-secondary" onclick="backFromProfile()">Cancel</button>
                        <button class="btn-primary" onclick="saveProfile()">Save</button>
                    </div>
                </div>
            </div>

            <!-- Load more / empty -->
            <div id="load-more" class="load-more" style="display:none;">
                <button onclick="loadMore()">Load older messages</button>
            </div>
            <div id="empty-state" class="empty" style="display:none;">
                <div class="icon">&#128172;</div>
                <div>No messages yet</div>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast"></div>

    <script>
    {{SCRIPTS}}
    </script>
</body>
</html>
